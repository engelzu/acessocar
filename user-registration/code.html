<!DOCTYPE html>
<html class="dark" lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Cadastro de Usuário - Admin</title>
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&amp;display=swap"
        rel="stylesheet" />
    <link
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap"
        rel="stylesheet" />
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <!-- Firebase Init -->
    <script src="../js/firebase-init.js"></script>
    <script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#135bec",
                        "background-light": "#f6f6f8",
                        "background-dark": "#101622",
                        "surface-dark": "#1e293b",
                        "border-dark": "#324467",
                        "border-light": "#e2e8f0",
                    },
                    fontFamily: {
                        "display": ["Inter", "sans-serif"]
                    },
                    borderRadius: { "DEFAULT": "0.25rem", "lg": "0.5rem", "xl": "0.75rem", "full": "9999px" },
                },
            },
        }
    </script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            min-height: 100vh;
        }
    </style>
</head>

<body class="bg-background-light dark:bg-background-dark text-slate-900 dark:text-white">
    <div
        class="relative flex h-full min-h-screen w-full flex-col overflow-hidden bg-background-light dark:bg-background-dark">

        <!-- Header -->
        <div
            class="sticky top-0 z-20 flex items-center bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-md p-4 pb-2 justify-between border-b border-border-light dark:border-border-dark/30">
            <button onclick="window.location.href='../welcome/code.html'"
                class="flex size-10 items-center justify-center rounded-full hover:bg-black/5 dark:hover:bg-white/10 transition-colors">
                <span class="material-symbols-outlined">arrow_back</span>
            </button>
            <h1 class="text-lg font-bold tracking-tight">Cadastro de Usuário</h1>
            <div class="w-10"></div> <!-- Spacer -->
        </div>

        <!-- Content -->
        <div class="flex-1 overflow-y-auto p-4 flex items-center justify-center">
            <div class="w-full max-w-md flex flex-col gap-6">

                <div
                    class="bg-white dark:bg-surface-dark p-6 rounded-2xl shadow-sm border border-border-light dark:border-border-dark">
                    <div class="flex flex-col items-center mb-6">
                        <div class="w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-3">
                            <span class="material-symbols-outlined text-primary text-2xl">person_add</span>
                        </div>
                        <h2 class="text-xl font-bold">Novo Usuário</h2>
                        <p class="text-sm text-slate-500 dark:text-slate-400">Cadastre um novo operador do sistema</p>
                    </div>

                    <form id="registerForm" class="flex flex-col gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-1">Nome Completo</label>
                            <input type="text" id="regName"
                                class="w-full rounded-xl border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-4 py-3 text-sm focus:ring-primary focus:border-primary"
                                placeholder="Ex: Maria Silva" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Email</label>
                            <input type="email" id="regEmail"
                                class="w-full rounded-xl border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-4 py-3 text-sm focus:ring-primary focus:border-primary"
                                placeholder="usuario@acessocar.com" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Senha</label>
                            <input type="password" id="regPass"
                                class="w-full rounded-xl border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-4 py-3 text-sm focus:ring-primary focus:border-primary"
                                placeholder="••••••••" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-1">Confirmar Senha</label>
                            <input type="password" id="regConfirmPass"
                                class="w-full rounded-xl border-border-light dark:border-border-dark bg-background-light dark:bg-background-dark px-4 py-3 text-sm focus:ring-primary focus:border-primary"
                                placeholder="••••••••" required>
                        </div>

                        <p id="regMessage" class="hidden text-center text-xs font-bold"></p>

                        <button type="submit" id="regBtn"
                            class="mt-2 w-full bg-primary hover:bg-blue-600 text-white font-bold py-3 rounded-xl shadow-lg transition-transform active:scale-[0.98]">
                            Cadastrar Usuário
                        </button>
                    </form>
                </div>

                <script>
                    document.getElementById('registerForm').addEventListener('submit', async (e) => {
                        e.preventDefault();
                        const name = document.getElementById('regName').value;
                        const email = document.getElementById('regEmail').value;
                        const pass = document.getElementById('regPass').value;
                        const confirmPass = document.getElementById('regConfirmPass').value;
                        const msg = document.getElementById('regMessage');
                        const btn = document.getElementById('regBtn');

                        if (pass !== confirmPass) {
                            msg.textContent = "As senhas não conferem.";
                            msg.classList.remove('hidden');
                            msg.classList.add('text-red-500');
                            return;
                        }

                        if (pass.length < 6) {
                            msg.textContent = "A senha deve ter pelo menos 6 caracteres.";
                            msg.classList.remove('hidden');
                            msg.classList.add('text-red-500');
                            return;
                        }

                        btn.disabled = true;
                        btn.textContent = "Cadastrando...";
                        msg.classList.add('hidden');

                        try {
                            // Create Authentication User
                            const userCredential = await auth.createUserWithEmailAndPassword(email, pass);
                            const user = userCredential.user;

                            // Create Firestore Document for User
                            await db.collection('users').doc(user.uid).set({
                                name: name,
                                email: email,
                                role: 'operator', // Default role
                                createdAt: firebase.firestore.FieldValue.serverTimestamp()
                            });

                            msg.textContent = "Usuário cadastrado com sucesso!";
                            msg.classList.remove('hidden', 'text-red-500');
                            msg.classList.add('text-green-500');

                            // Clear form
                            document.getElementById('registerForm').reset();

                            setTimeout(() => {
                                msg.classList.add('hidden');
                                btn.disabled = false;
                                btn.textContent = "Cadastrar Usuário";
                            }, 3000);

                        } catch (error) {
                            console.error(error);
                            let errorText = "Erro ao cadastrar: " + error.message;
                            if (error.code === 'auth/email-already-in-use') {
                                errorText = "Este email já está em uso.";
                            }
                            msg.textContent = errorText;
                            msg.classList.remove('hidden', 'text-green-500');
                            msg.classList.add('text-red-500');
                            btn.disabled = false;
                            btn.textContent = "Cadastrar Usuário";
                        }
                    });
                </script>

            </div>
        </div>
    </div>
</body>

</html>